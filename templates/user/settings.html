{% extends "base.html" %}

{% block title %}Account Settings - Pawfect Finds{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h2><i class="fas fa-cog"></i> Account Settings</h2>
            <p class="text-muted">Manage your profile and account preferences</p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8">
            <!-- Profile Information -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-user"></i> Profile Information</h5>
                </div>
<div class="card-body">
    <form method="POST" enctype="multipart/form-data">
        {{ profile_form.hidden_tag() }}
        
        <div class="row">
            <div class="col-md-6 mb-3">
                {{ profile_form.first_name.label(class="form-label") }}
                {{ profile_form.first_name(class="form-control", value=user.first_name) }}
                {% for error in profile_form.first_name.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-md-6 mb-3">
                {{ profile_form.last_name.label(class="form-label") }}
                {{ profile_form.last_name(class="form-control", value=user.last_name) }}
                {% for error in profile_form.last_name.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6 mb-3">
                {{ profile_form.username.label(class="form-label") }}
                {{ profile_form.username(class="form-control", value=user.username) }}
                {% for error in profile_form.username.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-md-6 mb-3">
                {{ profile_form.email.label(class="form-label") }}
                {{ profile_form.email(class="form-control", value=user.email) }}
                {% for error in profile_form.email.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
        </div>
        
        <div class="mb-3">
            {{ profile_form.phone.label(class="form-label") }}
            {{ profile_form.phone(class="form-control", value=user.phone or '') }}
            {% for error in profile_form.phone.errors %}
                <div class="text-danger small">{{ error }}</div>
            {% endfor %}
        </div>
        
        <div class="mb-3">
            {{ profile_form.address.label(class="form-label") }}
            {{ profile_form.address(class="form-control", rows=3, value=user.address or '') }}
            {% for error in profile_form.address.errors %}
                <div class="text-danger small">{{ error }}</div>
            {% endfor %}
        </div>
        
        <div class="mb-3">
            {{ profile_form.profile_image.label(class="form-label") }}
            {{ profile_form.profile_image(class="form-control") }}
            {% if user.profile_image %}
                <div class="mt-2">
                    <img src="{{ url_for('static', filename=user.profile_image) }}" alt="Current Profile Image" class="img-thumbnail" style="max-width: 100px; max-height: 100px;">
                    <small class="text-muted">Current profile image</small>
                </div>
            {% endif %}
            {% for error in profile_form.profile_image.errors %}
                <div class="text-danger small">{{ error }}</div>
            {% endfor %}
            <small class="text-muted">Upload JPG, PNG, or JPEG images only.</small>
        </div>
        
        {{ profile_form.submit(class="btn btn-primary") }}
    </form>
</div>
            </div>
            
            <!-- Change Password -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-lock"></i> Change Password</h5>
                </div>
<div class="card-body">
    <form method="POST">
        {{ password_form.hidden_tag() }}

        <div class="mb-3">
            {{ password_form.current_password.label(class="form-label") }}
            {{ password_form.current_password(class="form-control") }}
            {% for error in password_form.current_password.errors %}
                <div class="text-danger small">{{ error }}</div>
            {% endfor %}
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                {{ password_form.new_password.label(class="form-label") }}
                {{ password_form.new_password(class="form-control") }}
                <small class="text-muted">At least 6 characters</small>
                {% for error in password_form.new_password.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-md-6 mb-3">
                {{ password_form.confirm_password.label(class="form-label") }}
                {{ password_form.confirm_password(class="form-control") }}
                {% for error in password_form.confirm_password.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
        </div>

        {{ password_form.submit(class="btn btn-warning") }}
    </form>
</div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- Account Summary -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-user-circle"></i> Account Summary</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-6">
                            <small class="text-muted">Account Type</small>
                            <p class="fw-bold mb-0">
                                <span class="badge bg-{{ 'danger' if user.role == 'admin' else 'success' if user.role == 'seller' else 'primary' }}">
                                    {{ user.role.title() }}
                                </span>
                            </p>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Status</small>
                            <p class="fw-bold mb-0">
                                <span class="badge bg-{{ 'success' if user.status == 'active' else 'warning' if user.status == 'inactive' else 'danger' }}">
                                    {{ user.status.title() }}
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted">Member Since</small>
                        <p class="mb-0">{{ user.created_at.strftime('%B %Y') }}</p>
                    </div>
                    
                    {% if user.role == 'user' %}
                        <div class="d-grid">
                            <a href="{{ url_for('user.become_seller') }}" class="btn btn-success">
                                <i class="fas fa-handshake"></i> Become a Seller
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        {% if user.role == 'user' %}
                            <a href="{{ url_for('user.view_cart') }}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-shopping-cart"></i> View Cart
                            </a>
                            <a href="{{ url_for('user.orders') }}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-box"></i> My Orders
                            </a>
                            <a href="{{ url_for('public.browse_products') }}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-shopping-bag"></i> Shop Products
                            </a>
                        {% elif user.role == 'seller' %}
                            <a href="{{ url_for('seller.dashboard') }}" class="btn btn-outline-success btn-sm">
                                <i class="fas fa-store"></i> Seller Dashboard
                            </a>
                            <a href="{{ url_for('seller.products') }}" class="btn btn-outline-success btn-sm">
                                <i class="fas fa-boxes"></i> Manage Products
                            </a>
                            <a href="{{ url_for('seller.orders') }}" class="btn btn-outline-success btn-sm">
                                <i class="fas fa-shipping-fast"></i> Seller Orders
                            </a>
                        {% elif user.role == 'admin' %}
                            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-danger btn-sm">
                                <i class="fas fa-tachometer-alt"></i> Admin Dashboard
                            </a>
                            <a href="{{ url_for('admin.seller_requests') }}" class="btn btn-outline-danger btn-sm">
                                <i class="fas fa-handshake"></i> Seller Requests
                            </a>
                            <a href="{{ url_for('admin.manage_users') }}" class="btn btn-outline-danger btn-sm">
                                <i class="fas fa-users"></i> Manage Users
                            </a>
                        {% endif %}
                        
                        <hr class="my-2">
                        <a href="{{ url_for('user.dashboard') }}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-arrow-left"></i> Back to Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Password confirmation validation
document.getElementById('confirm_password').addEventListener('input', function() {
    const password = document.getElementById('new_password').value;
    const confirmPassword = this.value;
    
    if (password !== confirmPassword) {
        this.setCustomValidity('Passwords do not match');
    } else {
        this.setCustomValidity('');
    }
});

document.getElementById('new_password').addEventListener('input', function() {
    const confirmPassword = document.getElementById('confirm_password');
    if (confirmPassword.value) {
        confirmPassword.dispatchEvent(new Event('input'));
    }
});
</script>
{% endblock %}
